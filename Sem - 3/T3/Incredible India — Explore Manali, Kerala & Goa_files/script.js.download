// DOM ready
document.addEventListener("DOMContentLoaded", () => {

  /* NAV toggle for small screens */
  const navToggle = document.querySelector(".nav-toggle");
  const links = document.querySelector(".links");
  if (navToggle) {
    navToggle.addEventListener("click", () => links.classList.toggle("open"));
  }

  /* LETTER-BY-LETTER mission (preserve spaces) */
  document.querySelectorAll("[data-split]").forEach(container => {
    const heading = container.querySelector("h1, h2, h3, .mission-heading");
    if (!heading) return;
    const text = heading.textContent.trim();
    heading.innerHTML = "";
    [...text].forEach((ch, i) => {
      const span = document.createElement("span");
      span.textContent = ch === " " ? "\u00A0" : ch;
      span.style.animationDelay = `${i * 32}ms`;
      heading.appendChild(span);
    });
  });

  /* INTERSECTION OBSERVER - reveal elements elegantly */
  const revealObserver = new IntersectionObserver((entries, obs) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add("show");
        obs.unobserve(entry.target);
      }
    });
  }, { threshold: 0.12 });

  document.querySelectorAll(".reveal, .mission-inner").forEach(el => revealObserver.observe(el));

  /* TILT for cards */
  function applyTilt(el) {
    el.addEventListener("mousemove", e => {
      const rect = el.getBoundingClientRect();
      const x = (e.clientX - rect.left) / rect.width - 0.5;
      const y = (e.clientY - rect.top) / rect.height - 0.5;
      const rx = (y * 7).toFixed(2);
      const ry = (x * -9).toFixed(2);
      el.style.transform = `perspective(900px) rotateX(${rx}deg) rotateY(${ry}deg) translateZ(6px)`;
    });
    el.addEventListener("mouseleave", () => {
      el.style.transform = "perspective(900px) rotateX(0deg) rotateY(0deg) translateZ(0)";
    });
  }
  document.querySelectorAll("[data-tilt]").forEach(applyTilt);

  /* GOLD PARTICLES generator for ULTRA CTA */
  (function generateGoldParticles(){
    const particleCount = 28;
    const container = document.getElementById("goldParticles");
    if (!container) return;
    for (let i = 0; i < particleCount; i++) {
      const p = document.createElement("div");
      p.className = "gold-particle";
      p.style.left = Math.random() * 100 + "%";
      p.style.top = Math.random() * 100 + "%";
      const dur = 6 + Math.random() * 8;
      p.style.animation = `floatParticle ${dur}s linear ${Math.random()*3}s infinite`;
      p.style.opacity = 0.2 + Math.random() * 0.8;
      container.appendChild(p);
    }
    // add keyframe for floatParticle
    const styleSheet = document.createElement("style");
    styleSheet.textContent = `
      @keyframes floatParticle {
        0% { transform: translateY(0) translateX(0) scale(1); opacity: 0.2; }
        50% { transform: translateY(-40vh) translateX(12px) scale(1.2); opacity: 0.9; }
        100% { transform: translateY(-80vh) translateX(0) scale(0.9); opacity: 0.1; }
      }
    `;
    document.head.appendChild(styleSheet);
  })();

  /* Reduce motion accessibility */
  if (window.matchMedia("(prefers-reduced-motion: reduce)").matches) {
    document.querySelectorAll("*").forEach(n => n.style.transition = "none");
  }

});
/* LIGHTBOX POPUP */
const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightbox-img");
const lightboxVideo = document.getElementById("lightbox-video");
const closeBtn = document.querySelector(".close-lightbox");

document.querySelectorAll(".masonry-item").forEach(item => {
  item.addEventListener("click", () => {
    
    const type = item.getAttribute("data-type");
    const src = item.getAttribute("data-src");

    lightbox.style.display = "flex";

    // Reset both
    lightboxImg.style.display = "none";
    lightboxVideo.style.display = "none";

    if (type === "image") {
      lightboxImg.src = src;
      lightboxImg.style.display = "block";
    } else if (type === "video") {
      lightboxVideo.src = src;
      lightboxVideo.style.display = "block";
      lightboxVideo.play();
    }
  });
});

// Close popup
closeBtn.addEventListener("click", () => {
  lightbox.style.display = "none";
  lightboxVideo.pause();
});


/* Kerala Auto Image Carousel */
let keralaIndex = 0;
const keralaImages = document.querySelectorAll(".kerala-carousel .carousel-img");

function rotateKeralaImages() {
  keralaImages.forEach(img => img.classList.remove("active"));
  keralaImages[keralaIndex].classList.add("active");

  keralaIndex = (keralaIndex + 1) % keralaImages.length;
}

setInterval(rotateKeralaImages, 3000); // change every 3 seconds
rotateKeralaImages(); // initial load
